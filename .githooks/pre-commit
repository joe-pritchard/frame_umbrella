#!/usr/bin/env bash
set -euo pipefail

echo "Running pre-commit checks: mix format, credo, compile, dialyzer"

# ensure we run in project root (in case git runs hook from .git)
if [ -n "${GIT_DIR:-}" ]; then
  # If GIT_DIR set, try to change to repository root
  if [ -d "$(git rev-parse --show-toplevel 2>/dev/null)" ]; then
    cd "$(git rev-parse --show-toplevel)"
  fi
fi

echo "-> mix format --check-formatted"
mix format --check-formatted

echo "-> mix credo --strict"
mix credo --strict

echo "-> mix compile --warnings-as-errors"
mix compile --warnings-as-errors

echo "-> mix dialyzer"
mix dialyzer

echo "Pre-commit checks passed."

exit 0
